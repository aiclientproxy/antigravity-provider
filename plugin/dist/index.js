var AntigravityProviderPlugin=function(y,d,s){"use strict";var v={exports:{}},j={};/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var O=d,R=Symbol.for("react.element"),T=Symbol.for("react.fragment"),I=Object.prototype.hasOwnProperty,L=O.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,H={key:!0,ref:!0,__self:!0,__source:!0};function p(t,a,o){var c,x={},h=null,u=null;o!==void 0&&(h=""+o),a.key!==void 0&&(h=""+a.key),a.ref!==void 0&&(u=a.ref);for(c in a)I.call(a,c)&&!H.hasOwnProperty(c)&&(x[c]=a[c]);if(t&&t.defaultProps)for(c in a=t.defaultProps,a)x[c]===void 0&&(x[c]=a[c]);return{$$typeof:R,type:t,key:h,ref:u,props:x,_owner:L.current}}j.Fragment=T,j.jsx=p,j.jsxs=p,v.exports=j;var e=v.exports;function M(t){return t?{antigravity_oauth:"Google OAuth",kiro_oauth:"OAuth",gemini_oauth:"OAuth",qwen_oauth:"OAuth",openai_key:"API Key",claude_key:"API Key"}[t]||t:"未知"}function B(t){const a={manual:{text:"手动添加",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400"},imported:{text:"导入",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400"},private:{text:"私有",color:"bg-purple-100 text-purple-700 dark:bg-purple-900/30 dark:text-purple-400"},local:{text:"本地",color:"bg-gray-100 text-gray-700 dark:bg-gray-900/30 dark:text-gray-400"},remote:{text:"远程",color:"bg-cyan-100 text-cyan-700 dark:bg-cyan-900/30 dark:text-cyan-400"}};return a[t]||a.manual}function D(t){return{manual:s.User,imported:s.Upload,private:s.Lock,local:s.User,remote:s.Globe}[t]||s.User}function G({credential:t,isHealthy:a}){const o=B(t.source||"manual"),c=D(t.source||"manual");return e.jsxs("div",{className:"flex items-center gap-4",children:[e.jsx("div",{className:s.cn("shrink-0 rounded-full p-3",t.is_disabled?"bg-gray-100 dark:bg-gray-800":a?"bg-green-100 dark:bg-green-900/30":"bg-red-100 dark:bg-red-900/30"),children:t.is_disabled?e.jsx(s.PowerOff,{className:"h-6 w-6 text-gray-400"}):a?e.jsx(s.Heart,{className:"h-6 w-6 text-green-600 dark:text-green-400"}):e.jsx(s.HeartOff,{className:"h-6 w-6 text-red-600 dark:text-red-400"})}),e.jsxs("div",{className:"flex-1 min-w-0",children:[e.jsx("h4",{className:"font-semibold text-lg truncate",children:t.name||`凭证 #${t.uuid.slice(0,8)}`}),e.jsxs("div",{className:"flex flex-wrap items-center gap-2 mt-1.5",children:[e.jsxs("span",{className:"rounded-full bg-gradient-to-r from-purple-100 to-pink-100 dark:from-purple-900/30 dark:to-pink-900/30 px-2.5 py-1 text-xs font-medium text-purple-700 dark:text-purple-400 inline-flex items-center gap-1.5",children:[e.jsx(s.Sparkles,{className:"h-3 w-3"}),"Antigravity"]}),e.jsx("span",{className:"rounded-full bg-muted px-2.5 py-1 text-xs font-medium",children:M(t.credential_type)}),e.jsxs("span",{className:s.cn("rounded-full px-2.5 py-1 text-xs font-medium inline-flex items-center gap-1.5 whitespace-nowrap",o.color),children:[e.jsx(c,{className:"h-3 w-3 shrink-0"}),o.text]}),t.proxy_url&&e.jsxs("span",{className:"rounded-full px-2.5 py-1 text-xs font-medium inline-flex items-center gap-1.5 whitespace-nowrap bg-orange-100 text-orange-700 dark:bg-orange-900/30 dark:text-orange-400",title:`代理: ${t.proxy_url}`,children:[e.jsx(s.Globe,{className:"h-3 w-3 shrink-0"}),"代理"]})]})]})]})}function U({credential:t,isOAuth:a,checkingHealth:o,refreshingToken:c,deleting:x,onToggle:h,onEdit:u,onCheckHealth:g,onRefreshToken:m,onReset:b,onDelete:f}){return e.jsxs("div",{className:"flex items-center gap-2 shrink-0",children:[e.jsx("button",{onClick:h,className:s.cn("rounded-lg p-2.5 text-xs font-medium transition-colors",t.is_disabled?"bg-green-100 text-green-700 hover:bg-green-200 dark:bg-green-900/30 dark:text-green-400":"bg-gray-100 text-gray-700 hover:bg-gray-200 dark:bg-gray-800 dark:text-gray-300"),title:t.is_disabled?"启用":"禁用",children:t.is_disabled?e.jsx(s.Power,{className:"h-4 w-4"}):e.jsx(s.PowerOff,{className:"h-4 w-4"})}),e.jsx("button",{onClick:u,className:"rounded-lg bg-blue-100 p-2.5 text-blue-700 hover:bg-blue-200 dark:bg-blue-900/30 dark:text-blue-400 transition-colors",title:"编辑",children:e.jsx(s.Settings,{className:"h-4 w-4"})}),e.jsx("button",{onClick:g,disabled:o,className:"rounded-lg bg-emerald-100 p-2.5 text-emerald-700 hover:bg-emerald-200 disabled:opacity-50 dark:bg-emerald-900/30 dark:text-emerald-400 transition-colors",title:"检测",children:e.jsx(s.Activity,{className:s.cn("h-4 w-4",o&&"animate-pulse")})}),a&&e.jsx("button",{onClick:m,disabled:c,className:"rounded-lg bg-purple-100 p-2.5 text-purple-700 hover:bg-purple-200 disabled:opacity-50 dark:bg-purple-900/30 dark:text-purple-400 transition-colors",title:"刷新 Token",children:e.jsx(s.RefreshCw,{className:s.cn("h-4 w-4",c&&"animate-spin")})}),e.jsx("button",{onClick:b,className:"rounded-lg bg-orange-100 p-2.5 text-orange-700 hover:bg-orange-200 dark:bg-orange-900/30 dark:text-orange-400 transition-colors",title:"重置",children:e.jsx(s.RotateCcw,{className:"h-4 w-4"})}),e.jsx("button",{onClick:f,disabled:x,className:"rounded-lg bg-red-100 p-2.5 text-red-700 hover:bg-red-200 disabled:opacity-50 dark:bg-red-900/30 dark:text-red-400 transition-colors",title:"删除",children:e.jsx(s.Trash2,{className:"h-4 w-4"})})]})}function N(t){return t?new Date(t).toLocaleString("zh-CN",{month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}):"从未"}function F({credential:t,isOAuth:a}){var c;const o=(t.error_count||0)>0;return e.jsxs(e.Fragment,{children:[e.jsx("div",{className:"hidden sm:block px-4 py-3 bg-muted/30 border-t border-border/30",children:e.jsxs("div",{className:"grid grid-cols-4 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s.Activity,{className:"h-5 w-5 text-blue-500 shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"使用次数"}),e.jsx("div",{className:"font-bold text-xl tabular-nums",children:t.usage_count})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s.AlertTriangle,{className:s.cn("h-5 w-5 shrink-0",o?"text-yellow-500":"text-green-500")}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"错误次数"}),e.jsx("div",{className:"font-bold text-xl tabular-nums",children:t.error_count})]})]}),e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s.Clock,{className:"h-5 w-5 text-muted-foreground shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"最后使用"}),e.jsx("div",{className:"font-medium text-sm",children:N(t.last_used)})]})]}),a&&((c=t.token_cache_status)!=null&&c.expiry_time)?e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s.Timer,{className:s.cn("h-5 w-5 shrink-0",t.token_cache_status.is_expiring_soon?"text-yellow-500":t.token_cache_status.is_valid?"text-green-500":"text-red-500")}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"Token 有效期"}),e.jsx("div",{className:s.cn("font-medium text-sm",t.token_cache_status.is_expiring_soon?"text-yellow-600 dark:text-yellow-400":t.token_cache_status.is_valid?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"),children:N(t.token_cache_status.expiry_time)})]})]}):e.jsxs("div",{className:"flex items-center gap-3",children:[e.jsx(s.Activity,{className:"h-5 w-5 text-emerald-500 shrink-0"}),e.jsxs("div",{children:[e.jsx("div",{className:"text-xs text-muted-foreground",children:"健康检查"}),e.jsx("div",{className:"font-medium text-sm",children:N(t.last_health_check_time)})]})]})]})}),e.jsx("div",{className:"sm:hidden px-4 py-3 bg-muted/30 border-t border-border/30",children:e.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(s.Activity,{className:"h-4 w-4 text-blue-500"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"使用:"}),e.jsx("span",{className:"font-semibold",children:t.usage_count})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(s.AlertTriangle,{className:s.cn("h-4 w-4",o?"text-yellow-500":"text-green-500")}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"错误:"}),e.jsx("span",{className:"font-semibold",children:t.error_count})]}),e.jsxs("div",{className:"flex items-center gap-2 col-span-2",children:[e.jsx(s.Clock,{className:"h-4 w-4 text-muted-foreground"}),e.jsx("span",{className:"text-xs text-muted-foreground",children:"最后使用:"}),e.jsx("span",{className:"text-sm",children:N(t.last_used)})]})]})})]})}function z({credential:t,onToggle:a,onDelete:o,onReset:c,onCheckHealth:x,onRefreshToken:h,onEdit:u,deleting:g,checkingHealth:m,refreshingToken:b}){const f=(t.is_healthy??!1)&&!t.is_disabled,k=(t.credential_type??"").includes("oauth");return e.jsxs("div",{className:s.cn("rounded-xl border-2 transition-all hover:shadow-md",t.is_disabled?"border-gray-200 bg-gray-50/80 opacity-70 dark:border-gray-700 dark:bg-gray-900/60":f?"border-purple-200 bg-gradient-to-r from-purple-50/80 to-pink-50/80 dark:border-purple-800 dark:bg-gradient-to-r dark:from-purple-950/40 dark:to-pink-950/40":"border-red-200 bg-gradient-to-r from-red-50/80 to-white dark:border-red-800 dark:bg-gradient-to-r dark:from-red-950/40 dark:to-transparent"),children:[e.jsxs("div",{className:"flex items-center gap-4 p-4 pb-3",children:[e.jsx(G,{credential:t,isHealthy:f}),e.jsx(U,{credential:t,isOAuth:k,checkingHealth:m,refreshingToken:b,deleting:g,onToggle:a,onEdit:u,onCheckHealth:x,onRefreshToken:h,onReset:c,onDelete:o})]}),e.jsx(F,{credential:t,isOAuth:k}),e.jsx("div",{className:"px-4 py-2 border-t border-border/30",children:e.jsx("p",{className:"text-xs text-muted-foreground font-mono",children:t.uuid})}),t.last_error_message&&e.jsxs("div",{className:"mx-4 mb-3 rounded-lg bg-red-100 p-3 text-xs text-red-700 dark:bg-red-900/30 dark:text-red-300",children:[t.last_error_message.slice(0,150),t.last_error_message.length>150&&"..."]}),e.jsxs("div",{className:"mx-4 mb-3 rounded-lg bg-purple-50 dark:bg-purple-950/30 p-3 text-xs text-purple-700 dark:text-purple-300",children:[e.jsx("div",{className:"font-medium mb-1",children:"支持的模型："}),e.jsxs("div",{className:"flex flex-wrap gap-1",children:[e.jsx("span",{className:"px-2 py-0.5 bg-purple-100 dark:bg-purple-900/50 rounded",children:"Gemini 3 Pro"}),e.jsx("span",{className:"px-2 py-0.5 bg-purple-100 dark:bg-purple-900/50 rounded",children:"Gemini 2.5 Flash"}),e.jsx("span",{className:"px-2 py-0.5 bg-pink-100 dark:bg-pink-900/50 rounded",children:"Claude Sonnet 4.5"}),e.jsx("span",{className:"px-2 py-0.5 bg-pink-100 dark:bg-pink-900/50 rounded",children:"Claude Opus 4.5"})]})]})]})}function K(t){const[a,o]=d.useState([]),[c,x]=d.useState(!0),[h,u]=d.useState(null),[g,m]=d.useState(!1),[b,f]=d.useState(!1),[k,w]=d.useState(!1),[V,_]=d.useState(null),[W,A]=d.useState(!1),[J,S]=d.useState(new Set),[Y,E]=d.useState(new Set),[Z,P]=d.useState(new Set),i=d.useCallback(async()=>{try{x(!0),u(null);const r=await s.providerPoolApi.getCredentials("antigravity");o(r)}catch(r){u(r instanceof Error?r.message:"加载凭证失败")}finally{x(!1)}},[]);d.useEffect(()=>{i()},[i]);const Q=d.useCallback(()=>{m(!1),i(),s.toast.success("凭证添加成功")},[i]),X=d.useCallback(async r=>{if(confirm("确定要删除这个凭证吗？"))try{S(l=>new Set(l).add(r)),await s.providerPoolApi.deleteCredential(r,"antigravity"),s.toast.success("凭证已删除"),i()}catch(l){s.toast.error(l instanceof Error?l.message:"删除失败")}finally{S(l=>{const n=new Set(l);return n.delete(r),n})}},[i]),C=d.useCallback(async(r,l)=>{try{await s.providerPoolApi.toggleCredential(r,!l),s.toast.success(l?"凭证已启用":"凭证已禁用"),i()}catch(n){s.toast.error(n instanceof Error?n.message:"操作失败")}},[i]),q=d.useCallback(async r=>{try{await s.providerPoolApi.resetCredential(r),s.toast.success("凭证已重置"),i()}catch(l){s.toast.error(l instanceof Error?l.message:"重置失败")}},[i]),$=d.useCallback(async r=>{try{E(n=>new Set(n).add(r));const l=await s.providerPoolApi.checkCredentialHealth(r);l.success?s.toast.success("凭证验证通过"):s.toast.error(l.message||"凭证验证失败"),i()}catch(l){s.toast.error(l instanceof Error?l.message:"验证失败")}finally{E(l=>{const n=new Set(l);return n.delete(r),n})}},[i]),ee=d.useCallback(async r=>{try{P(l=>new Set(l).add(r)),await s.providerPoolApi.refreshCredentialToken(r),s.toast.success("Token 刷新成功"),i()}catch(l){s.toast.error(l instanceof Error?l.message:"刷新失败")}finally{P(l=>{const n=new Set(l);return n.delete(r),n})}},[i]),se=d.useCallback(r=>{_(r),A(!0)},[]),te=d.useCallback(async(r,l)=>{try{await s.providerPoolApi.updateCredential(r,l),s.toast.success("凭证已更新"),i()}catch(n){throw new Error(`编辑失败: ${n instanceof Error?n.message:String(n)}`)}},[i]),re=d.useCallback(()=>{A(!1),_(null)},[]),ae=d.useCallback(async()=>{f(!0);try{for(const r of a)await s.providerPoolApi.refreshCredentialToken(r.uuid);s.toast.success("所有凭证已刷新"),i()}catch(r){s.toast.error(r instanceof Error?r.message:"刷新失败")}finally{f(!1)}},[a,i]),le=d.useCallback(async()=>{w(!0);try{let r=0,l=0;for(const n of a)(await s.providerPoolApi.checkCredentialHealth(n.uuid)).success?r++:l++;s.toast.info(`验证完成: ${r} 个有效, ${l} 个无效`),i()}catch(r){s.toast.error(r instanceof Error?r.message:"验证失败")}finally{w(!1)}},[a,i]);return c?e.jsxs("div",{className:"flex items-center justify-center p-8",children:[e.jsx(s.Loader2,{className:"h-6 w-6 animate-spin text-muted-foreground"}),e.jsx("span",{className:"ml-2 text-muted-foreground",children:"加载凭证..."})]}):h?e.jsxs("div",{className:"flex flex-col items-center justify-center p-8",children:[e.jsx(s.AlertCircle,{className:"h-8 w-8 text-red-500 mb-2"}),e.jsx("p",{className:"text-red-600 mb-4",children:h}),e.jsxs(s.Button,{variant:"outline",onClick:i,children:[e.jsx(s.RefreshCw,{className:"h-4 w-4 mr-2"}),"重试"]})]}):e.jsxs("div",{className:"p-4 space-y-4",children:[e.jsxs("div",{className:"flex items-center justify-between",children:[e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsx(s.Sparkles,{className:"h-5 w-5 text-purple-500"}),e.jsx("h2",{className:"text-lg font-semibold",children:"Antigravity 凭证管理"})]}),e.jsxs("div",{className:"flex items-center gap-2",children:[e.jsxs(s.Button,{variant:"outline",size:"sm",onClick:le,disabled:k||a.length===0,children:[k?e.jsx(s.Loader2,{className:"h-4 w-4 mr-1 animate-spin"}):e.jsx(s.Zap,{className:"h-4 w-4 mr-1"}),"检测全部"]}),e.jsxs(s.Button,{variant:"outline",size:"sm",onClick:ae,disabled:b||a.length===0,children:[b?e.jsx(s.Loader2,{className:"h-4 w-4 mr-1 animate-spin"}):e.jsx(s.RefreshCw,{className:"h-4 w-4 mr-1"}),"刷新全部"]}),e.jsxs(s.Button,{size:"sm",onClick:()=>m(!0),children:[e.jsx(s.Plus,{className:"h-4 w-4 mr-1"}),"添加凭证"]})]})]}),e.jsxs("div",{className:"rounded-lg border border-purple-200 bg-gradient-to-r from-purple-50 to-pink-50 dark:border-purple-800 dark:from-purple-950/30 dark:to-pink-950/30 p-4",children:[e.jsx("p",{className:"text-sm text-purple-700 dark:text-purple-300 font-medium mb-2",children:"动态协议选择"}),e.jsxs("ul",{className:"text-xs text-purple-600 dark:text-purple-400 space-y-1",children:[e.jsxs("li",{children:["• ",e.jsx("strong",{children:"gemini-*"})," 模型 → Gemini 协议输出"]}),e.jsxs("li",{children:["• ",e.jsx("strong",{children:"claude-*"})," 模型 → Anthropic 协议输出"]})]})]}),a.length===0?e.jsxs("div",{className:"flex flex-col items-center justify-center p-12 border-2 border-dashed rounded-xl text-muted-foreground",children:[e.jsx(s.Sparkles,{className:"h-12 w-12 mb-4 opacity-50 text-purple-400"}),e.jsx("p",{className:"text-lg font-medium mb-1",children:"暂无凭证"}),e.jsx("p",{className:"text-sm mb-4",children:'点击"添加凭证"开始配置'}),e.jsxs(s.Button,{onClick:()=>m(!0),children:[e.jsx(s.Plus,{className:"h-4 w-4 mr-1"}),"添加第一个凭证"]})]}):e.jsx("div",{className:"space-y-4",children:a.map(r=>e.jsx(z,{credential:r,onToggle:()=>C(r.uuid,r.is_disabled),onDelete:()=>X(r.uuid),onReset:()=>q(r.uuid),onCheckHealth:()=>$(r.uuid),onRefreshToken:()=>ee(r.uuid),onEdit:()=>se(r),deleting:J.has(r.uuid),checkingHealth:Y.has(r.uuid),refreshingToken:Z.has(r.uuid)},r.uuid))}),e.jsx(s.Modal,{isOpen:g,onClose:()=>m(!1),maxWidth:"max-w-lg",children:e.jsxs("div",{className:"p-6",children:[e.jsxs("h3",{className:"text-lg font-semibold mb-4 flex items-center gap-2",children:[e.jsx(s.Sparkles,{className:"h-5 w-5 text-purple-500"}),"添加 Antigravity 凭证"]}),e.jsx(s.AntigravityFormStandalone,{onSuccess:Q,onCancel:()=>m(!1)})]})}),e.jsx(s.EditCredentialModal,{credential:V,isOpen:W,onClose:re,onEdit:te})]})}return y.default=K,Object.defineProperties(y,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}}),y}({},React,ProxyCastPluginComponents);
